#!/bin/bash
# Pre-commit hook untuk menjalankan validasi sebelum commit

set -e

echo "üîç Running pre-commit checks..."

# 1. Run analyze
echo "üìã Running flutter analyze..."
flutter analyze

# 2. Check formatting
echo "üé® Checking code formatting..."
dart format --set-exit-if-changed . || (
  echo "‚ùå Code formatting issues found. Run 'dart format .' to fix."
  exit 1
)

# 3. Run tests
echo "‚úÖ Running unit tests..."
flutter test --coverage

# 4. Verify no untracked large files
echo "üì¶ Checking file sizes..."
git diff --cached --name-only | while read file; do
  size=$(du -b "$file" 2>/dev/null | cut -f1)
  if [ "$size" -gt 5242880 ]; then
    echo "‚ùå File too large: $file ($((size / 1024 / 1024))MB)"
    exit 1
  fi
done

echo "‚úÖ All pre-commit checks passed!"
